From 75aa3a46737272a9975350c02fadefb53b1b0280 Mon Sep 17 00:00:00 2001
From: Gladwistor <aitali.alan@gmail.com>
Date: Mon, 29 Jan 2018 14:15:35 +0100
Subject: [PATCH] add imx219 devicetree

---
 arch/arm/boot/dts/imx6-openrexbasic.dts | 17 ++++++------
 arch/arm/boot/dts/imx6qdl-openrex.dtsi  | 46 +++++++++++++++++++++++++++------
 arch/arm/boot/dts/imx6qdl.dtsi          |  4 +--
 3 files changed, 48 insertions(+), 19 deletions(-)

diff --git a/arch/arm/boot/dts/imx6-openrexbasic.dts b/arch/arm/boot/dts/imx6-openrexbasic.dts
index 88099b8..811ceef 100644
--- a/arch/arm/boot/dts/imx6-openrexbasic.dts
+++ b/arch/arm/boot/dts/imx6-openrexbasic.dts
@@ -40,22 +40,21 @@
 
 &i2c2 {
 	/* Raspberry Pi camera rev 1.3 */
-	ov5647_mipi: ov5647_mipi@36 {
-		compatible = "ovti,ov5647_mipi_int";
-		reg = <0x36>;
-		/* Pi camera has its own 25MHz clock. */
+	imx219: imx219@64 {
+		compatible = "sony,imx219";
+		reg = <0x64>;
+		// Pi camera has its own 25MHz clock. 
 		clocks = <&clks IMX6QDL_CLK_DUMMY>;
 		clock-names = "csi_mclk";
-		DOVDD-supply = <&reg_1p8v>;
-		AVDD-supply = <&reg_2p8v>;
-		DVDD-supply = <&reg_1p5v>;
+		VANA-supply = <&reg_2p8v>;
+		VDDL-supply = <&reg_1p2v>;
+		VDIG-supply = <&reg_1p8v>;
 		pwn-gpios = <&gpio7 6 GPIO_ACTIVE_HIGH>;
-		led-gpios = <&gpio7 7 GPIO_ACTIVE_HIGH>;
 		csi_id = <1>;
 		mclk = <25000000>;
 		mclk_source = <0>;
 		pinctrl-names = "default";
-		pinctrl-0 = <&pinctrl_ov5647_mipi>;
+		pinctrl-0 = <&pinctrl_imx219>;
 	};
 };
 
diff --git a/arch/arm/boot/dts/imx6qdl-openrex.dtsi b/arch/arm/boot/dts/imx6qdl-openrex.dtsi
index 130b9d9..b9956ff 100644
--- a/arch/arm/boot/dts/imx6qdl-openrex.dtsi
+++ b/arch/arm/boot/dts/imx6qdl-openrex.dtsi
@@ -155,9 +155,18 @@
 		#address-cells = <1>;
 		#size-cells = <0>;
 
-		reg_1p5v: 1p5v {
+		reg_1p2v: 1p2v {
 			compatible = "regulator-fixed";
 			reg = <0>;
+			regulator-name = "1P2V";
+			regulator-min-microvolt = <1200000>;
+			regulator-max-microvolt = <1200000>;
+			regulator-always-on;
+		};
+
+		reg_1p5v: 1p5v {
+			compatible = "regulator-fixed";
+			reg = <1>;
 			regulator-name = "1P5V";
 			regulator-min-microvolt = <1500000>;
 			regulator-max-microvolt = <1500000>;
@@ -166,7 +175,7 @@
 
 		reg_1p8v: 1p8v {
 			compatible = "regulator-fixed";
-			reg = <1>;
+			reg = <2>;
 			regulator-name = "1P8V";
 			regulator-min-microvolt = <1800000>;
 			regulator-max-microvolt = <1800000>;
@@ -175,7 +184,7 @@
 
 		reg_2p8v: 2p8v {
 			compatible = "regulator-fixed";
-			reg = <2>;
+			reg = <3>;
 			regulator-name = "2P8V";
 			regulator-min-microvolt = <2800000>;
 			regulator-max-microvolt = <2800000>;
@@ -184,7 +193,7 @@
 
 		reg_3p3v: 3p3v {
 			compatible = "regulator-fixed";
-			reg = <3>;
+			reg = <4>;
 			regulator-name = "3P3V";
 			regulator-min-microvolt = <3300000>;
 			regulator-max-microvolt = <3300000>;
@@ -226,10 +235,8 @@
 	v4l2_cap_1 {
 		compatible = "fsl,imx6q-v4l2-capture";
 		ipu_id = <0>;
-		csi_id = <1>;
+		csi_id = <0>;
 		mclk_source = <0>;
-		mipi_camera = <1>;
-		default_input = <1>;
 		status = "okay";
 	};
 
@@ -641,6 +648,24 @@
 			>;
 		};
 
+        	pinctrl_ipu1_1: ipu1grp-1 { /* parallel camera */
+            		fsl,pins = <
+                		MX6QDL_PAD_CSI0_DAT12__IPU1_CSI0_DATA12    0x80000000
+                		MX6QDL_PAD_CSI0_DAT13__IPU1_CSI0_DATA13    0x80000000
+                		MX6QDL_PAD_CSI0_DAT14__IPU1_CSI0_DATA14    0x80000000
+                		MX6QDL_PAD_CSI0_DAT15__IPU1_CSI0_DATA15    0x80000000
+                		MX6QDL_PAD_CSI0_DAT16__IPU1_CSI0_DATA16    0x80000000
+                		MX6QDL_PAD_CSI0_DAT17__IPU1_CSI0_DATA17    0x80000000
+                		MX6QDL_PAD_CSI0_DAT18__IPU1_CSI0_DATA18    0x80000000
+                		MX6QDL_PAD_CSI0_DAT19__IPU1_CSI0_DATA19    0x80000000
+                		MX6QDL_PAD_CSI0_PIXCLK__IPU1_CSI0_PIXCLK   0x0000a0b0
+                		MX6QDL_PAD_CSI0_MCLK__IPU1_CSI0_HSYNC      0x80000000
+                		MX6QDL_PAD_CSI0_VSYNC__IPU1_CSI0_VSYNC     0x80000000
+                		MX6QDL_PAD_EIM_WAIT__GPIO5_IO00            0x80000000
+                		MX6QDL_PAD_CSI0_DATA_EN__GPIO5_IO20    0x80000000
+            		>;
+		};
+
 		pinctrl_ipu2_csi1: ipu2_csi1grp { /* parallel camera */
 			fsl,pins = <
 /*
@@ -699,7 +724,12 @@
 		pinctrl_ov5647_mipi: ov5647_mipigrp {
 			fsl,pins = <
 				MX6QDL_PAD_SD3_DAT2__GPIO7_IO06		0x00017059 /* RPI Camera PWR */
-				MX6QDL_PAD_SD3_DAT3__GPIO7_IO07		0x00013059 /* RPI Camera LED */
+				MX6QDL_PAD_SD3_DAT3__GPIO7_IO07		0x00013059 /* RPI Camera LED*/
+			>;
+		};
+		pinctrl_imx219: imx219_grp {
+			fsl,pins = <
+				MX6QDL_PAD_SD3_DAT2__GPIO7_IO06		0x00017059 /* RPI Camera PWR */
 			>;
 		};
 
diff --git a/arch/arm/boot/dts/imx6qdl.dtsi b/arch/arm/boot/dts/imx6qdl.dtsi
index 522d017..bb4ede9 100644
--- a/arch/arm/boot/dts/imx6qdl.dtsi
+++ b/arch/arm/boot/dts/imx6qdl.dtsi
@@ -1263,11 +1263,11 @@
 			clocks = <&clks IMX6QDL_CLK_IPU1>,
 				 <&clks IMX6QDL_CLK_IPU1_DI0>, <&clks IMX6QDL_CLK_IPU1_DI1>,
 				 <&clks IMX6QDL_CLK_IPU1_DI0_SEL>, <&clks IMX6QDL_CLK_IPU1_DI1_SEL>,
-				 <&clks IMX6QDL_CLK_LDB_DI0>, <&clks IMX6QDL_CLK_LDB_DI1>;
+				 <&clks IMX6QDL_CLK_LDB_DI0>, <&clks IMX6QDL_CLK_LDB_DI1>, <&clks MX6QDL_PAD_CSI0_PIXCLK__IPU1_CSI0_PIXCLK>;
 			clock-names = "bus",
 				      "di0", "di1",
 				      "di0_sel", "di1_sel",
-				      "ldb_di0", "ldb_di1";
+				      "ldb_di0", "ldb_di1", "ipu1_csi0";
 			resets = <&src 2>;
 			bypass_reset = <0>;
 		};
-- 
2.7.4

